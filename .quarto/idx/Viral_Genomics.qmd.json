{"title":"Viral Phylogenomics","markdown":{"yaml":{"title-block-style":"default","title-block-banner":"darkred","title":"Viral Phylogenomics","subtitle":"Profling a Pandemic","author":"Profs Tom Connor and Peter Kille","date":"today","affiliation":"Cardiff University"},"headingText":"Viral Sequencing and analysis","containsRefs":false,"markdown":"\n\n<iframe data-external=\"1\" src=\"https://cardiff.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=ea6dc880-93a8-4f6e-9aa1-af2d00c6064c&amp;autoplay=false&amp;offerviewer=true&amp;showtitle=true&amp;showbrand=true&amp;captions=false&amp;interactivity=all\" height=\"405\" width=\"720\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\">\n\n</iframe>\n\n<iframe data-external=\"1\" src=\"https://cardiff.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=a9ac7c64-e72a-4a08-b3e1-af3800d6b17b&amp;autoplay=false&amp;offerviewer=true&amp;showtitle=true&amp;showbrand=true&amp;captions=false&amp;interactivity=all\" height=\"405\" width=\"720\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\">\n\n</iframe>\n\n\n## Introduction\n\nThe pandemic lineage evolution in a short video [nextclade](https://nextstrain.org/ncov/gisaid/global/6m?branchLabel=emerging_lineage)\n\n<iframe data-external=\"1\" src=\"https://cardiff.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=04f5593b-fe6e-4eb7-a69a-af3700e1e41e&autoplay=false&offerviewer=true&showtitle=true&showbrand=true&captions=false&interactivity=all\" height=\"405\" width=\"720\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n\nvideo \"https://cardiff.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=04f5593b-fe6e-4eb7-a69a-af3700e1e41e\"\n\nThe derivation and viral lineages has played an essential part in our understanding and fight against the pandemic. The tutorial will take you through the steps where-by viral sequence is derived and analysed.\n\n[GISAID](https://gisaid.org/) provides a range of resources to explore lineage prevalence and mutation comparison between lineages.\n\nHere's some key analyses it provides using the lineage sequence data:\n\nLineage Distribution (Omicron):\n\n![Omicron Sequence distribution](images/Omicron_lineage_report.png){width=\"50%\"}\n\nLineage distribution Location in UK\n\n![Lineage location / distribution in UK](images/UK_location_report.png){width=\"50%\"}\n\nMutation frequency across lineages\n\n![Mutation frequency across lineages](images/Mutations_accross_lineage.png){width=\"50%\"}\n\n## Viral sequencing\n\nThere a range of methods for deriving viral sequences from biological material. The basic steps are:\n\n1.  Sample acquisition - saliva or Nasal swabs\n2.  Nucleic acid extraction (RNA or DNA depending on virus)\n3.  Reverse transcription (for RNA viruses)\n4.  Viral enrichment (introduction of specimen specific indexes if multiplexing)\n5.  Library constriction (introduction of specimen specific indexes if multiplexing)\n6.  Sequencing (Illumina and Nanopore)\n\n**Steps 4 and 5 can be reversed if using capture enrichment approaches**\n\n**Indexes can be introduced in steps 3 OR 4 but not both**\n\nA good review of these methods is provided by [Gohl et al 2020](https://doi.org/10.1186/s12864-020-07283-6) and is summarized in Figure 1. Also see [Rosenthal et al., 2022](https://doi.org/10.1038/s41598-022-06091-0).\n\n![Sequencing Workflows: Gohl et al 2020 Fig 1](images/Gohl_et_al_2020_Fig1.png){width=\"50%\"}\n\nThe approach that most used is what has been named the [ARTIC protocol](https://artic.network/ncov-2019). This approach used 76 primer pairs to amplify the viral genome 2 sets of overlapping amplification reactions each containing 38 primer sets generating amplicons of \\~400 bp. These amplicons were then pooled and sequenced (Illumina or Nanopore) to generate the complete genome.\n\n## Raw Data Sequence Analysis QC\n\n1.  Quality assess and quality trim sequences\n2.  Align sequences to reference covid genome (throw-away sequences that do not align)\n3.  Evaluate coverage\n4.  Mask primers used for amplification\n5.  Derive consensus\n6.  Determine Variants\n\nNow some hands on data analysis, So lets do some analysis !!\n\n# Analysis Workflow of Raw Sequencing Data\n\n## Data\n\nFor the element of the workshop we have used Viral re-sequencing data generated using the ARTIC-V3 protocol from the [COVID-19 Data Portal - EMBL](https://www.covid19dataportal.org/). The following illumia paired end data was downloaded:\n\n    SRR13018901_1.fastq.gz  SRR13635734_2.fastq.gz  SRR15359995_1.fastq.gz  SRR15360031_2.fastq.gz  SRR15910995_1.fastq.gz  SRR16192823_2.fastq.gz\n    SRR13018901_2.fastq.gz  SRR13635763_1.fastq.gz  SRR15359995_2.fastq.gz  SRR15365583_1.fastq.gz  SRR15910995_2.fastq.gz\n    SRR13635734_1.fastq.gz  SRR13635763_2.fastq.gz  SRR15360031_1.fastq.gz  SRR15365583_2.fastq.gz  SRR16192823_1.fastq.gz\n\nNote: We are using 'pair end data' some there is 2 sequences for each sample representing the forward and reverse samples.\n\nReference Severe acute respiratory syndrome coronavirus 2 isolate Wuhan-Hu-1 complete genome sequence (fasta) and annotation (gff) was downloaded from NCBI nucleotide database (https://www.ncbi.nlm.nih.gov/nuccore/MN908947.3). (\\>send to \\> Complete Record \\> file \\> (FASTA/GFF3))\n\n    MN908947.3.fasta\n    MN908947.3.gff\n\n## Software\n\n### cov2019 Artic Nextflow Workflow\n\nPrimary analysis work flow was performed using [cov2019-artic-nf](https://github.com/connor-lab/) pipeline. This analysis was performed using a High Performance Linux (Ubuntu 20.04) Workstation (24 threads and 64 Gb RAM) running nexflow (https://www.nextflow.io/) and singularity (https://github.com/sylabs/singularity). command used to perform the analysis:\n\n    nextflow run connor-lab/ncov2019-artic-nf \\ #analsyis pipline\n            -profile singularity \\              #platform for software\n            --illumina \\                        #data type\n            --outdir $PWD/artic_analysis \\      #output folder\n            --prefix \"artic_test_run_221022\" \\  #output prefix\n            --directory $PWD/fastq_files/       #location of input files\n            --bed ~/covid_processing/artic_config_files/artic_V3.bed \\     #primer sequences in bed format\n            --ref ~/covid_processing/nimagen_conf_files/MN908947.3.fasta \\ #template sequence \n            --gff ~/covid_processing/nimagen_conf_files/MN908947.3.gff \\   #template annotation\n            --yaml ~/covid_processing/nimagen_conf_files/SARS-CoV-2.types.yaml #covid classification file\n\n**YOU WILL NOT BE ABLE TO PERFORM THIS ANALYSIS, YOU WILL BE PROVIDED WITH THE OUTPUT OF THE PIPELINE WHICH CONTAINS THE FOLLOWING FOLDERS.**\n\n    artic_analysis/\n    ├── artic_test_run_221022.qc.csv\n    ├── artic_test_run_221022.typing_summary.csv\n    ├── artic_test_run_221022.variant_summary.csv\n    ├── ncovIllumina_Genotyping_typeVariants\n    ├── ncovIllumina_sequenceAnalysis_callVariants\n    ├── ncovIllumina_sequenceAnalysis_makeConsensus\n    ├── ncovIllumina_sequenceAnalysis_readMapping\n    ├── ncovIllumina_sequenceAnalysis_readTrimming\n    ├── ncovIllumina_sequenceAnalysis_trimPrimerSequences\n    ├── qc_pass_climb_upload\n    └── qc_plots\n\n### Genome Visualisation Software - IGB\n\nWe will visualize the primary outputs using [Integrated Genome Browser](https://bioviz.org/) this can be downloaded and install on all platforms. It is also available as part of the BIOSI School software tools on the teaching workstation.\n\n## Workshop exercise\n\n### 1. Review the QC summary and QC Plot\n\nQC summary (this can be opened by opening `artic_test_run_221022.qc.csv` into excel)\n\n| sample_name | pct_N\\_bases | pct_covered_bases | longest_no_N\\_run | num_aligned_reads | fasta                                  | bam                                         | qc_pass |\n|---------|---------|---------|---------|---------|---------|---------|---------|\n| SRR13018901 | 18.63        | 81.37             | 3133              | 492459            | SRR13018901.primertrimmed.consensus.fa | SRR13018901.mapped.primertrimmed.sorted.bam | TRUE    |\n\nNow review the linked QC plot that can be found in \\artic\\_analysis\\qc\\_plots\n\n![Sequence QC Plot](C:/Users/smbpk/Cardiff%20University/Omics%20revolution%20course%20-%20Viral%20Genomics/artic_analysis/qc_plots/SRR13018901.depth.png){width=\"50%\"} Derive what the QC parameters are that would influence viral analsyis\n\n### 2. Review and Overlay the reference genome (FASTA), annotation (GFF) and primer trimmed alignment file (bam)\n\nPreview the fasta file and gff file using a text editor (wordpad / textpad on PC or Textedit on Mac). You cannot preview the bam file as it is a compressed binary file and is not human readable.\n\nfile locations:\n\n    Omics revolution course - Viral Genomics\\Reference_files\\MN908947.3.fasta\n    Omics revolution course - Viral Genomics\\Reference_files\\MN908947.3.gff\n    Omics revolution course - Viral\\ Genomics\\artic_analysis\\ncovIllumina_sequenceAnalysis_trimPrimerSequences\\SRR13018901.mapped.primertrimmed.sorted.bam\n\nFasta Preview ([fasta format guide](https://www.ncbi.nlm.nih.gov/genbank/fastaformat/))\n\n    >MN908947.3 Severe acute respiratory syndrome coronavirus 2 isolate Wuhan-Hu-1, complete genome\n    ATTAAAGGTTTATACCTTCCCAGGTAACAAACCAACCAACTTTCGATCTCTTGTAGATCTGTTCTCTAAA\n    CGAACTTTAAAATCTGTGTGGCTGTCACTCGGCTGCATGCTTAGTGCACTCACGCAGTATAATTAATAAC\n    TAATTACTGTCGTTGACAGGACACGAGTAACTCGTCTATCTTCTGCAGGCTGCTTACGGTTTCGTCCGTG\n    .....\n\nGFF preview ([GFF3 format guide](https://www.ensembl.org/info/website/upload/gff3.html))\n\n    ##gff-version 3\n    ##sequence-region   MN908947.3 1 29903\n    #!genome-build ENA ASM985889v3\n    #!genome-version ASM985889v3\n    #!genome-date 2020-01\n    #!genome-build-accession NCBI:GCA_009858895.3\n    MN908947.3      ASM985889v3     region  1       29903   .       .       .       ID=region:MN908947.3;Alias=NC_045512.2,NC_045512v2\n    ####\n    MN908947.3      ensembl gene    266     13483   .       +       .       ID=gene:ENSSASG00005000003;Name=ORF1ab;biotype=protein_coding;description=ORF1a polyprotein%3BORF1ab polyprotein [Source:NCBI gene (formerly Entrezgene)%3BAcc:43740578];gene_id=ENSSASG00005000003;logic_name=ensembl_covid;version=1\n    MN908947.3      ensembl mRNA    266     13483   .       +       .       ID=transcript:ENSSAST00005000003;Parent=gene:ENSSASG00005000003;Name=ORF1a;biotype=protein_coding;transcript_id=ENSSAST00005000003;version=1\n    MN908947.3      ensembl exon    266     13483   .       +       .       Parent=transcript:ENSSAST00005000003;Name=ENSSASE00005000003;constitutive=1;ensembl_end_phase=0;ensembl_phase=0;exon_id=ENSSASE00005000003;rank=1;version=1\n    ....\n\nNow overlay these features using Integrated Genome Browser using the following steps:\n\n-   Open IGB\n\n![IGB Openign Screen](images/IGB_opening.png){width=\"50%\"} \\* Open the fasta sequence as a genome\n\n![Open Fasta as Genome](images/Open_fasta_as_genome.png) Remember to 'Load Genome when are back on main screen\n\n![Load Sequence](images/Load_sequence.png)\n\n-   Add and load gff\n\nopen gff `> File > Open File > [Select gff from file browser]`\n\nLoad data\n\n![Load Sequence](images/Load_data.png) You should now see a preview of the annotated genome looking something like this:\n\n![Load gff](images/Gff_preview.png)\n\n-   Add mapped primertrimmed sorted bam\n\nFile location:\n\n    Omics revolution course - Viral\\ Genomics\\artic_analysis\\ncovIllumina_sequenceAnalysis_trimPrimerSequences\\SRR13018901.mapped.primertrimmed.sorted.bam\n\nopen bam `> File > Open File > [Select bam from file browser]`\n\nNow load data as you did previously.\n\nYou should now see a preview of the annotated genome with bam overlay looking something like this (it may take time to appear):\n\n![Load gff](images/Bam_preview.png)\n\nuse slider and top to zoom in to see the primer masking and SNPs:\n\n![Load BAM](images/Bam_Zoom.png)\n\n-   Explore settings on IGB to visualize the primer sites and mutations - identify synonymous and non-synonymous mutations\n\n### Explore the Varient amino acids encoded by the sequence (this file can be opened in Excel)\n\n`Omics revolution course - Viral Genomics\\artic_analysis\\artic_test_run_221022.variant_summary.csv`\n\n| sampleID    | gene   | aa_var    | dna_var |\n|-------------|--------|-----------|---------|\n| SRR13018901 | ORF1ab | Syn.924F  | C3037T  |\n| SRR13018901 | ORF1ab | Syn.1749N | C5512T  |\n| SRR13018901 | S      | Syn.53D   | C21721T |\n\n# Phylogenetic Classification of Concensus Viral Sequnece\n\n## Data\n\nData was download from [GISAID](https://gisaid.org/) representing viral sequences from across (time and space) of the pandemic.\n\nThese sequences can be found in: `Omics revolution course - Viral Genomics\\Viral_sequences\\SARAS-CoV-2`\n\n    EPI_ISL_14569384.fasta\n    EPI_ISL_14871243.fasta\n    EPI_ISL_15038461.fasta\n    EPI_ISL_15165123.fasta\n    EPI_ISL_15196344.fasta\n    EPI_ISL_15233297.fasta\n    EPI_ISL_15251359.fasta\n    EPI_ISL_15266729.fasta\n    EPI_ISL_15266749.fasta\n    EPI_ISL_15283205.fasta\n    EPI_ISL_15395946.fasta\n    EPI_ISL_15400456.fasta\n    EPI_ISL_15422334.fasta\n    EPI_ISL_15424763.fasta\n    EPI_ISL_15426260.fasta\n    EPI_ISL_15436037.fasta\n    EPI_ISL_15458335.fasta\n    EPI_ISL_15463432.fasta\n    EPI_ISL_15466700.fasta\n    EPI_ISL_402128.fasta\n    EPI_ISL_529216.fasta\n\n## Software\n\nNextclade is a tool that identifies differences between your sequences and a reference sequence, uses these differences to assign your sequences to clades, and reports potential sequence quality issues in your data. You can use the tool to analyze sequences before you upload them to a database, or if you want to assign Nextstrain clades to a set of sequences.\n\nTo analyze your data, drag a fasta file onto the upload box or paste sequences into the text box. These sequences will then be analyzed in your browser - data never leave your computer. Since your computer is doing the work rather than a server, it is advisable to analyze at most a few hundred sequences at a time.\n\nThe source code for the application and algorithms is opensource and is available on GitHub. User manual is available at docs.nextstrain.org/projects/nextclade.\n\n[Nextclade](https://clades.nextstrain.org/)\n\n![Nextflow Opening page](images/Nextclade_open.png)\n\n## Workshop exercise\n\n-   \n\n    1.  Load run sequence analysis\n\n![Drag in fasta](images/Drag_in_fasta.png)\n\n![Nexclade run](images/Nextclade_run.png)\n\n-   \n\n    2.  Review the Results\n\n![Nexclade results](images/Nextclade_result.png)\n\nClick / hover over the element of the analysis to see more detail\n\n![Nexclade QC](images/Nextclade_qc.png) ![Nexclade Varients](images/Nextclade_varients.png) ![Nexclade Insertions](images/Nextclade_ins.png)\n\n![Nexclade deletions/gaps](images/Nextclade_del.png) \\* 3. Review the position fall on the phylogenetic tree\n\nClick on the tree icon at the top right of the screen\n\n![Nexclade tree](images/Nextclade_Tree.png)\n\n-   \n\n    4.  Download and review results\n\nClick on the download icon at the top right of the screen\n\n![Nexclade download icon](images/Nextclade_download.png) I suggest using nextclade.tsv and opening file in excel.\n\n-   \n\n    5.  Now repeat the analysis with other sequences provided\n\n-   \n\n    6.  Can you determine where and when each sequence was derived from ?\n\n# Structural and Varient analysis\n\n## Data\n\nData was download from [GISAID](https://gisaid.org/) representing viral sequences from across (time and space) of the pandemic.\n\nThese sequences can be found in: `Omics revolution course - Viral Genomics\\Viral_sequences\\SARAS-CoV-2`\n\n## Software\n\n[GISAID Covsurver](https://gisaid.org/database-features/covsurver-mutations-app/)\n\n![CoVsurver Open](images/Covsurver_open.png)\n\n## Workshop exercise\n\n-   \n\n    1.  Upload and analysis sequences provide\n\nYou should see the following outputs - discuss how this help in fighting the pandemic ?\n\n![CoVsurver 3d](images/Covsurver_spike3D.png) ![CoVsurver Varients](images/Covsurver_varients.png)\n\nCovsurver_varients\n\n# Viral Databases and resources\n\n## Sequencing approaches\n\n-   [Artic Network](https://artic.network/ncov-2019)\n\n## Analytical tools\n\n-   [Nextclade](https://clades.nextstrain.org/)\n-   [GISAID Covsurver](https://gisaid.org/database-features/covsurver-mutations-app/)\n\n## Data portals\n\n-   [COVID-19 Data Portal - EMBL](https://www.covid19dataportal.org/)\n-   [NCBI Viral Dash board](https://www.ncbi.nlm.nih.gov/labs/virus/)\n-   [GISAID](https://gisaid.org/)\n-   [NextStrain](https://nextstrain.org/)\n\n## Lineage comparison Data bases\n\n-   [Outbreak](https://gisaid.org/lineage-comparison/)\n\n# References\n\n[Gohl, D.M., Garbe, J., Grady, P. et al. A rapid, cost-effective tailed amplicon method for sequencing SARS-CoV-2. BMC Genomics 21, 863 (2020).](https://doi.org/10.1186/s12864-020-07283-6)\n\n[Rosenthal, S.H., Gerasimova, A., Ruiz-Vega, R. et al. Development and validation of a high throughput SARS-CoV-2 whole genome sequencing workflow in a clinical laboratory. Sci Rep 12, 2054 (2022). https://doi.org/10.1038/s41598-022-06091-0](https://www.nature.com/articles/s41598-022-06091-0)\n\n<iframe data-external=\"1\" src=\"https://cardiff.cloud.panopto.eu/Panopto/Pages/Embed.aspx?id=5952eccf-19f1-4610-93ba-af3900e83f1a&autoplay=false&offerviewer=true&showtitle=true&showbrand=true&captions=false&interactivity=all\" height=\"405\" width=\"720\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"Viral_Genomics.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.313","editor":"visual","theme":"cosmo","title-block-style":"default","title-block-banner":"darkred","title":"Viral Phylogenomics","subtitle":"Profling a Pandemic","author":"Profs Tom Connor and Peter Kille","date":"today","affiliation":"Cardiff University"},"extensions":{"book":{"multiFile":true}}}}}